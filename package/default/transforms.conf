# Extract all fields from ufdbguard space-delimited logs
# Format: MMM DD HH:MM:SS.mmm hostname ufdbguard[PID] YYYY-MM-DD HH:MM:SS [thread] DECISION username src_ip source_category category requested_url method acl_match
[ufdbguard_extract_fields]
REGEX = ^(\w+\s+\d+\s+[\d:\.]+)\s+(\S+)\s+ufdbguard\[(\d+)\]\s+(\S+\s+\S+)\s+\[(\d+)\]\s+(\w+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)\s+(\S+)
FORMAT = syslog_timestamp::$1 proxy_host::$2 process_id::$3 ufdb_timestamp::$4 thread_id::$5 decision::$6 user::$7 src_ip::$8 source_category::$9 category::$10 url::$11 http_method::$12 acl_match::$13

# Optional: Exclude healthcheck events
[ufdbguard_exclude_healthcheck]
REGEX = healthcheck
DEST_KEY = queue
FORMAT = nullQueue

# Lookup for decision categorization
[ufdbguard_decision_lookup]
filename = ufdbguard_decisions.csv
case_sensitive_match = false

# Lookup for category descriptions
[ufdbguard_category_lookup]
filename = ufdbguard_categories.csv
case_sensitive_match = false

# Parse URL components from url field
# Handles both full URLs (http://site/path) and host:port format (site:443)
[ufdbguard_parse_url]
SOURCE_KEY = url
REGEX = ^(?:(?<http_scheme>https?)://)?(?<site>[^:/?#]+)(?::(?<dest_port>\d+))?(?<uri_path>/[^?#]*)?(?:\?(?<uri_query>[^#]*))?(?:#(?<uri_fragment>.*))?
FORMAT = http_scheme::$1 site::$2 dest_port::$3 uri_path::$4 uri_query::$5 uri_fragment::$6
